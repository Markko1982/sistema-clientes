#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Sistema de Gerenciamento de Clientes e Produtos
Menu principal integrado
"""

import cliente
import produto
import sys

def limpar_tela():
    """Limpa a tela do terminal"""
    import os
    os.system('clear' if os.name != 'nt' else 'cls')

def pausar():
    """Pausa e aguarda Enter"""
    input("\nâ¸ï¸  Pressione ENTER para continuar...")

def menu_principal():
    """Menu principal do sistema"""
    while True:
        limpar_tela()
        print("=" * 80)
        print(" " * 20 + "ğŸ¢ SISTEMA DE GERENCIAMENTO")
        print("=" * 80)
        print("\nğŸ“‹ MENU PRINCIPAL:\n")
        print("   1. ğŸ‘¥ Gerenciar Clientes")
        print("   2. ğŸ“¦ Gerenciar Produtos")
        print("   3. ğŸ“Š RelatÃ³rios")
        print("   4. â„¹ï¸  Sobre o Sistema")
        print("   5. ğŸšª Sair")
        print("\n" + "-" * 80)
        
        opcao = input("\nğŸ‘‰ Escolha uma opÃ§Ã£o: ").strip()
        
        if opcao == "1":
            menu_clientes()
        elif opcao == "2":
            menu_produtos()
        elif opcao == "3":
            menu_relatorios()
        elif opcao == "4":
            sobre_sistema()
        elif opcao == "5":
            limpar_tela()
            print("\n" + "=" * 80)
            print(" " * 25 + "ğŸ‘‹ ATÃ‰ LOGO!")
            print("=" * 80)
            print("\n   Obrigado por usar o Sistema de Gerenciamento!")
            print("\n" + "=" * 80 + "\n")
            sys.exit(0)
        else:
            print("\nâŒ OpÃ§Ã£o invÃ¡lida! Tente novamente.")
            pausar()

def menu_clientes():
    """Menu de gerenciamento de clientes"""
    while True:
        limpar_tela()
        print("=" * 80)
        print(" " * 25 + "ğŸ‘¥ GERENCIAR CLIENTES")
        print("=" * 80)
        print("\nğŸ“‹ OPÃ‡Ã•ES:\n")
        print("   1. â• Cadastrar novo cliente")
        print("   2. ğŸ“‹ Listar todos os clientes")
        print("   3. ğŸ” Buscar cliente por ID")
        print("   4. âœï¸  Atualizar cliente")
        print("   5. ğŸ—‘ï¸  Deletar cliente")
        print("   6. ğŸ“Š EstatÃ­sticas de clientes")
        print("   7. â¬…ï¸  Voltar ao menu principal")
        print("\n" + "-" * 80)
        
        opcao = input("\nğŸ‘‰ Escolha uma opÃ§Ã£o: ").strip()
        
        if opcao == "1":
            cadastrar_cliente()
        elif opcao == "2":
            listar_clientes()
        elif opcao == "3":
            buscar_cliente()
        elif opcao == "4":
            atualizar_cliente()
        elif opcao == "5":
            deletar_cliente()
        elif opcao == "6":
            estatisticas_clientes()
        elif opcao == "7":
            break
        else:
            print("\nâŒ OpÃ§Ã£o invÃ¡lida!")
            pausar()

def menu_produtos():
    """Menu de gerenciamento de produtos"""
    while True:
        limpar_tela()
        print("=" * 80)
        print(" " * 25 + "ğŸ“¦ GERENCIAR PRODUTOS")
        print("=" * 80)
        print("\nğŸ“‹ OPÃ‡Ã•ES:\n")
        print("   1. â• Cadastrar novo produto")
        print("   2. ğŸ“‹ Listar todos os produtos")
        print("   3. ğŸ” Buscar produto por ID")
        print("   4. âœï¸  Atualizar produto")
        print("   5. ğŸ—‘ï¸  Deletar produto")
        print("   6. ğŸ“Š EstatÃ­sticas de produtos")
        print("   7. â¬…ï¸  Voltar ao menu principal")
        print("\n" + "-" * 80)
        
        opcao = input("\nğŸ‘‰ Escolha uma opÃ§Ã£o: ").strip()
        
        if opcao == "1":
            cadastrar_produto()
        elif opcao == "2":
            listar_produtos()
        elif opcao == "3":
            buscar_produto()
        elif opcao == "4":
            atualizar_produto()
        elif opcao == "5":
            deletar_produto()
        elif opcao == "6":
            estatisticas_produtos()
        elif opcao == "7":
            break
        else:
            print("\nâŒ OpÃ§Ã£o invÃ¡lida!")
            pausar()

def menu_relatorios():
    """Menu de relatÃ³rios"""
    limpar_tela()
    print("=" * 80)
    print(" " * 28 + "ğŸ“Š RELATÃ“RIOS")
    print("=" * 80)
    print("\nğŸ”§ Em desenvolvimento...\n")
    print("   RelatÃ³rios disponÃ­veis em breve:")
    print("   â€¢ Top 10 clientes")
    print("   â€¢ Produtos mais vendidos")
    print("   â€¢ Vendas por cidade")
    print("   â€¢ Estoque baixo")
    print("\n" + "=" * 80)
    pausar()

def sobre_sistema():
    """InformaÃ§Ãµes sobre o sistema"""
    limpar_tela()
    print("=" * 80)
    print(" " * 25 + "â„¹ï¸  SOBRE O SISTEMA")
    print("=" * 80)
    print("\nğŸ“‹ Sistema de Gerenciamento de Clientes e Produtos")
    print("\nğŸ“… VersÃ£o: 1.0.0")
    print("ğŸ‘¤ Desenvolvedor: Markko")
    print("ğŸ—„ï¸  Banco de Dados: PostgreSQL")
    print("ğŸ Linguagem: Python 3")
    print("ğŸ“ Git: https://github.com/Markko1982/sistema-clientes" )
    print("\nğŸ’¡ Funcionalidades:")
    print("   âœ… Gerenciamento de clientes")
    print("   âœ… Gerenciamento de produtos")
    print("   âœ… ImportaÃ§Ã£o de CSV")
    print("   âœ… Busca avanÃ§ada")
    print("   â³ RelatÃ³rios (em breve)")
    print("   â³ Sistema de vendas (em breve)")
    print("\n" + "=" * 80)
    pausar()

# ============================================================================
# FUNÃ‡Ã•ES DE CLIENTES
# ============================================================================

def cadastrar_cliente():
    """Cadastra novo cliente"""
    limpar_tela()
    print("=" * 80)
    print(" " * 25 + "â• CADASTRAR CLIENTE")
    print("=" * 80)
    
    try:
        nome = input("\nğŸ‘¤ Nome: ").strip()
        email = input("ğŸ“§ Email: ").strip()
        telefone = input("ğŸ“± Telefone: ").strip()
        cidade = input("ğŸ™ï¸  Cidade: ").strip()
        
        if nome and email:
            cliente.cadastrar_cliente(nome, email, telefone, cidade)
        else:
            print("\nâŒ Nome e email sÃ£o obrigatÃ³rios!")
    except Exception as e:
        print(f"\nâŒ Erro: {e}")
    
    pausar()

def listar_clientes():
    """Lista todos os clientes"""
    limpar_tela()
    print("=" * 80)
    print(" " * 25 + "ğŸ“‹ LISTA DE CLIENTES")
    print("=" * 80)
    
    try:
        clientes = cliente.listar_clientes(limite=20)
        
        if clientes:
            print(f"\nâœ… Total: {len(clientes)} clientes\n")
            print("-" * 80)
            print(f"{'ID':<5} {'NOME':<30} {'EMAIL':<30} {'CIDADE':<15}")
            print("-" * 80)
            
            for c in clientes:
                print(f"{c[0]:<5} {c[1][:30]:<30} {c[2][:30]:<30} {c[4][:15] if c[4] else '-':<15}")
            
            print("-" * 80)
        else:
            print("\nâš ï¸  Nenhum cliente cadastrado.")
    except Exception as e:
        print(f"\nâŒ Erro: {e}")
    
    pausar()

def buscar_cliente():
    """Busca cliente por ID"""
    limpar_tela()
    print("=" * 80)
    print(" " * 25 + "ğŸ” BUSCAR CLIENTE")
    print("=" * 80)
    
    try:
        cliente_id = int(input("\nğŸ”¢ ID do cliente: ").strip())
        c = cliente.buscar_cliente(cliente_id)
        
        if c:
            print("\nâœ… Cliente encontrado:\n")
            print(f"   ID: {c[0]}")
            print(f"   Nome: {c[1]}")
            print(f"   Email: {c[2]}")
            print(f"   Telefone: {c[3] if c[3] else '-'}")
            print(f"   Cidade: {c[4] if c[4] else '-'}")
        else:
            print(f"\nâŒ Cliente ID {cliente_id} nÃ£o encontrado.")
    except ValueError:
        print("\nâŒ ID invÃ¡lido!")
    except Exception as e:
        print(f"\nâŒ Erro: {e}")
    
    pausar()

def atualizar_cliente():
    """Atualiza dados de um cliente"""
    limpar_tela()
    print("=" * 80)
    print(" " * 25 + "âœï¸  ATUALIZAR CLIENTE")
    print("=" * 80)
    
    try:
        cliente_id = int(input("\nğŸ”¢ ID do cliente: ").strip())
        
        print("\nï¿½ï¿½ Deixe em branco para nÃ£o alterar\n")
        nome = input("ğŸ‘¤ Novo nome: ").strip() or None
        email = input("ğŸ“§ Novo email: ").strip() or None
        telefone = input("ğŸ“± Novo telefone: ").strip() or None
        cidade = input("ğŸ™ï¸  Nova cidade: ").strip() or None
        
        cliente.atualizar_cliente(cliente_id, nome, email, telefone, cidade)
    except ValueError:
        print("\nâŒ ID invÃ¡lido!")
    except Exception as e:
        print(f"\nâŒ Erro: {e}")
    
    pausar()

def deletar_cliente():
    """Deleta um cliente"""
    limpar_tela()
    print("=" * 80)
    print(" " * 25 + "ğŸ—‘ï¸  DELETAR CLIENTE")
    print("=" * 80)
    
    try:
        cliente_id = int(input("\nğŸ”¢ ID do cliente: ").strip())
        
        confirma = input(f"\nâš ï¸  Tem certeza que deseja deletar o cliente ID {cliente_id}? (s/n): ").strip().lower()
        
        if confirma == 's':
            cliente.deletar_cliente(cliente_id)
        else:
            print("\nâŒ OperaÃ§Ã£o cancelada.")
    except ValueError:
        print("\nâŒ ID invÃ¡lido!")
    except Exception as e:
        print(f"\nâŒ Erro: {e}")
    
    pausar()

def estatisticas_clientes():
    """Mostra estatÃ­sticas de clientes"""
    limpar_tela()
    print("=" * 80)
    print(" " * 25 + "ğŸ“Š ESTATÃSTICAS")
    print("=" * 80)
    
    try:
        total = cliente.contar_clientes()
        print(f"\nâœ… Total de clientes cadastrados: {total}")
    except Exception as e:
        print(f"\nâŒ Erro: {e}")
    
    pausar()

# ============================================================================
# FUNÃ‡Ã•ES DE PRODUTOS
# ============================================================================

def cadastrar_produto():
    """Cadastra novo produto"""
    limpar_tela()
    print("=" * 80)
    print(" " * 25 + "â• CADASTRAR PRODUTO")
    print("=" * 80)
    
    try:
        nome = input("\nğŸ“¦ Nome: ").strip()
        preco = float(input("ğŸ’° PreÃ§o: R$ ").strip())
        estoque = int(input("ğŸ“Š Estoque: ").strip())
        categoria = input("ğŸ·ï¸  Categoria: ").strip()
        descricao = input("ğŸ“ DescriÃ§Ã£o (opcional): ").strip() or None
        
        if nome and preco >= 0 and estoque >= 0:
            produto.cadastrar_produto(nome, preco, estoque, categoria, descricao)
        else:
            print("\nâŒ Dados invÃ¡lidos!")
    except ValueError:
        print("\nâŒ PreÃ§o e estoque devem ser nÃºmeros!")
    except Exception as e:
        print(f"\nâŒ Erro: {e}")
    
    pausar()

def listar_produtos():
    """Lista todos os produtos"""
    limpar_tela()
    print("=" * 80)
    print(" " * 25 + "ğŸ“‹ LISTA DE PRODUTOS")
    print("=" * 80)
    
    try:
        produtos = produto.listar_produtos(limite=20)
        
        if produtos:
            print(f"\nâœ… Total: {len(produtos)} produtos\n")
            print("-" * 80)
            print(f"{'ID':<5} {'NOME':<30} {'PREÃ‡O':<12} {'ESTOQUE':<10} {'CATEGORIA':<15}")
            print("-" * 80)
            
            for p in produtos:
                print(f"{p[0]:<5} {p[1][:30]:<30} R$ {p[2]:<9.2f} {p[3]:<10} {p[4][:15]:<15}")
            
            print("-" * 80)
        else:
            print("\nâš ï¸  Nenhum produto cadastrado.")
    except Exception as e:
        print(f"\nâŒ Erro: {e}")
    
    pausar()

def buscar_produto():
    """Busca produto por ID"""
    limpar_tela()
    print("=" * 80)
    print(" " * 25 + "ğŸ” BUSCAR PRODUTO")
    print("=" * 80)
    
    try:
        produto_id = int(input("\nğŸ”¢ ID do produto: ").strip())
        p = produto.buscar_produto(produto_id)
        
        if p:
            print("\nâœ… Produto encontrado:\n")
            print(f"   ID: {p[0]}")
            print(f"   Nome: {p[1]}")
            print(f"   DescriÃ§Ã£o: {p[2] if p[2] else '-'}")
            print(f"   PreÃ§o: R$ {p[3]:.2f}")
            print(f"   Estoque: {p[4]}")
            print(f"   Categoria: {p[5]}")
        else:
            print(f"\nâŒ Produto ID {produto_id} nÃ£o encontrado.")
    except ValueError:
        print("\nâŒ ID invÃ¡lido!")
    except Exception as e:
        print(f"\nâŒ Erro: {e}")
    
    pausar()

def atualizar_produto():
    """Atualiza dados de um produto"""
    limpar_tela()
    print("=" * 80)
    print(" " * 25 + "âœï¸  ATUALIZAR PRODUTO")
    print("=" * 80)
    
    try:
        produto_id = int(input("\nğŸ”¢ ID do produto: ").strip())
        
        print("\nğŸ’¡ Deixe em branco para nÃ£o alterar\n")
        nome = input("ğŸ“¦ Novo nome: ").strip() or None
        preco_str = input("ğŸ’° Novo preÃ§o: R$ ").strip()
        preco = float(preco_str) if preco_str else None
        estoque_str = input("ğŸ“Š Novo estoque: ").strip()
        estoque = int(estoque_str) if estoque_str else None
        categoria = input("ğŸ·ï¸  Nova categoria: ").strip() or None
        descricao = input("ğŸ“ Nova descriÃ§Ã£o: ").strip() or None
        
        produto.atualizar_produto(produto_id, nome, preco, estoque, categoria, descricao)
    except ValueError:
        print("\nâŒ Dados invÃ¡lidos!")
    except Exception as e:
        print(f"\nâŒ Erro: {e}")
    
    pausar()

def deletar_produto():
    """Deleta um produto"""
    limpar_tela()
    print("=" * 80)
    print(" " * 25 + "ğŸ—‘ï¸  DELETAR PRODUTO")
    print("=" * 80)
    
    try:
        produto_id = int(input("\nğŸ”¢ ID do produto: ").strip())
        
        confirma = input(f"\nâš ï¸  Tem certeza que deseja deletar o produto ID {produto_id}? (s/n): ").strip().lower()
        
        if confirma == 's':
            produto.deletar_produto(produto_id)
        else:
            print("\nâŒ OperaÃ§Ã£o cancelada.")
    except ValueError:
        print("\nâŒ ID invÃ¡lido!")
    except Exception as e:
        print(f"\nâŒ Erro: {e}")
    
    pausar()

def estatisticas_produtos():
    """Mostra estatÃ­sticas de produtos"""
    limpar_tela()
    print("=" * 80)
    print(" " * 25 + "ğŸ“Š ESTATÃSTICAS")
    print("=" * 80)
    
    try:
        stats = produto.estatisticas_produtos()
        
        if stats:
            print(f"\nâœ… Total de produtos: {stats['total']}")
            print(f"ğŸ“¦ Estoque total: {stats['estoque_total']} unidades")
            
            if stats['mais_caro']:
                print(f"ğŸ’° Mais caro: {stats['mais_caro'][0]} - R$ {stats['mais_caro'][1]:.2f}")
            
            if stats['mais_barato']:
                print(f"ğŸ’µ Mais barato: {stats['mais_barato'][0]} - R$ {stats['mais_barato'][1]:.2f}")
            
            if stats['por_categoria']:
                print("\nğŸ“Š Por categoria:")
                for cat, total in stats['por_categoria']:
                    print(f"   {cat}: {total} produtos")
    except Exception as e:
        print(f"\nâŒ Erro: {e}")
    
    pausar()

# ============================================================================
# MAIN
# ============================================================================

if __name__ == "__main__":
    try:
        menu_principal()
    except KeyboardInterrupt:
        limpar_tela()
        print("\n\n" + "=" * 80)
        print(" " * 25 + "ğŸ‘‹ SISTEMA ENCERRADO")
        print("=" * 80 + "\n")
        sys.exit(0)
